spec_id: SPEC-REFACTOR-CONSTANTS-001
title: "Extract magic numbers to named constants"
status: draft

given_when_then:
  - given: "_invoke_model() has hardcoded API_TIMEOUT_SECONDS = 180.0 (line 192)"
    when: "developer moves to class constant StreamingTranslator.API_TIMEOUT_SECONDS"
    then: "value is centralized and easily tunable"

  - given: "_invoke_model() has hardcoded ESTIMATED_OUTPUT_TOKEN_RATIO = 1.3 (line 190)"
    when: "developer moves to StreamingTranslator.ESTIMATED_OUTPUT_TOKEN_RATIO"
    then: "token estimation logic is self-documenting"

  - given: "_invoke_model() has hardcoded KOREAN_CHAR_TO_TOKEN_RATIO = 2.5 (line 191)"
    when: "developer moves to StreamingTranslator.KOREAN_CHAR_TO_TOKEN_RATIO"
    then: "Korean text tokenization factor is centralized"

  - given: "text_preprocessor.py uses hardcoded '  ' (2 spaces) for indentation (line 37)"
    when: "developer adds TextPreprocessor.CONFIG_INDENT constant"
    then: "indentation is single point of change"

acceptance_tests:
  - id: TEST-REFACTOR-CONSTANTS-001-AC1
    desc: "StreamingTranslator.API_TIMEOUT_SECONDS = 180.0 defined as class constant"
    expected: "Value accessible via cls.API_TIMEOUT_SECONDS, used in _invoke_model()"

  - id: TEST-REFACTOR-CONSTANTS-001-AC2
    desc: "ESTIMATED_OUTPUT_TOKEN_RATIO = 1.3 defined and used consistently"
    expected: "Same value in _invoke_model() line 202 replaces literal 1.3"

  - id: TEST-REFACTOR-CONSTANTS-001-AC3
    desc: "KOREAN_CHAR_TO_TOKEN_RATIO = 2.5 defined and used in progress updates"
    expected: "Lines 226-227 use constant instead of literal 2.5"

  - id: TEST-REFACTOR-CONSTANTS-001-AC4
    desc: "TextPreprocessor.CONFIG_INDENT = '  ' used in add_text_to_file()"
    expected: "Line 37 uses self.CONFIG_INDENT or class constant"

  - id: TEST-REFACTOR-CONSTANTS-001-AC5
    desc: "Constants grouped in class header for easy discoverability"
    expected: "All magic numbers listed as class attributes at top of class"

  - id: TEST-REFACTOR-CONSTANTS-001-AC6
    desc: "Test coverage maintained at 100%"
    expected: "All constant values exercised by existing test suite"

dependencies:
  - governance: "coding-style.md (constants naming conventions)"
  - related_task: "TASK-20251228-REFACTOR-DEDUP-001"

linked_tasks:
  - TASK-20251228-REFACTOR-CONSTANTS-001

notes:
  - "Magic numbers are scattered across _invoke_model() method"
  - "text_preprocessor.py has implicit indentation constant"
  - "Improves maintainability for model tuning and internationalization"
  - "No behavior change, pure refactoring"
